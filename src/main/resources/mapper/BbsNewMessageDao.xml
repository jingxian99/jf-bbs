<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jfsoft.bbs.dao.BbsNewMessageDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.jfsoft.bbs.entity.BbsNewMessageEntity" id="bbsNewMessageMap">
        <result property="id" column="id"/>
        <result property="content" column="content"/>
        <result property="type" column="type"/>
        <result property="createTime" column="create_time"/>
        <result property="createPer" column="create_per"/>
        <result property="title" column="title"/>
        <result property="memo" column="memo"/>
        <result property="postsId" column="posts_id"/>
    </resultMap>

    <resultMap id="MessageVoMap" type="com.jfsoft.bbs.form.MessageVo">
        <collection property="sponsor" ofType="com.jfsoft.bbs.entity.BbsUserEntity"
                    column="{userId=userId}"
                    select="selectUserInfo"/>
        <collection property="postsEntity" ofType="com.jfsoft.bbs.entity.BbsPostsEntity"
                    column="{userId=replyToUserId}"
                    select="selectUserInfo"/>
        <collection property="messageEntity" ofType="com.jfsoft.bbs.entity.BbsNewMessageEntity"
                    column="{postsId=postsId,parentId=id}"
                    select="findOtherReplay"/>
    </resultMap>

    <select id="querySelfMessage" parameterType="map" resultMap="MessageVoMap">
        select br.content, br.init_time as initTime, br.author, br.user_id as userId, br.parent_id as parentId, br.id,
        br.posts_id as postsId, br.user_id, br.reply_to as replyToUserId
        from bbs_posts bp
        left join bbs_reply br on br.posts_id = bp.id
        where br.parent_id = '0' and br.posts_id = #{postsId}
        order by br.init_time desc
    </select>

</mapper>